---
weight: 22700
title: "Il2Cpp Modding"
description: "Differences in Il2Cpp and how to work around them"
icon: "psychology_alt"
date: "2025-06-28T01:51:07+02:00"
lastmod: "2025-06-28T01:51:07+02:00"
draft: false
toc: true
---

Il2Cpp and Mono modding share many similarities, but there are some differences that you should be aware of when modding main branch Schedule I.

{{< alert context="info" >}}
Many examples (and possibly, a better explanation) can be found on the <a href="https://melonwiki.xyz/#/modders/il2cppdifferences">Il2Cpp Differences MelonWiki page</a>.
{{< /alert >}}

### Assemblies
In Mono, you can directly reference
```csharp
using FishNet;
using ScheduleOne.PlayerScripts;
```
This part isn't so different in Il2Cpp, but some assemblies (generated by Il2CppAssemblyGenerator) are prefixed with `Il2Cpp` in the name, so you need to reference them like this:
```csharp
using Il2CppFishNet;
using Il2CppScheduleOne.PlayerScripts;
```

### Types
Similarly, some methods might use `Il2Cpp` types instead of regular C# types. For example, `Il2CppSystem.Collections.Generic.List<T>` instead of `System.Collections.Generic.List<T>`.

{{< alert context="warning" >}}
Main pain-point is that you can't use LINQ on <b>Il2Cpp</b> types directly, but that can be worked around by adding <code>._items</code>.
{{< /alert >}}

```csharp
Il2CppSystem.Collections.Generic.List<int> list;
list.FirstOrDefault(); // This won't work
list._items.FirstOrDefault(); // This will work
```

If you want to grab the IL2CPP type of a class, you can use `Il2CppType.Of<T>()` method. For example:
```csharp
using Il2CppInterop.Runtime;
Resources.FindObjectsOfTypeAll(Il2CppType.Of<Camera>());
```

#### Casting
You'll often need to cast types. While in Mono the compiler can infer the type, eg. when creating a callback action, in Il2Cpp you need to specify the type explicitly:
```csharp
addButton.onClick.AddListener((UnityAction)(() => {
 // Do something
}));
```
For types with no explicit cast, use `.Cast<T>()` or `.TryCast<T>()` method
```csharp
Type result = il2CppObj.Cast<Type>();
```

### Custom Components
If you want to create a custom component or inherit a Il2Cpp class, you need to use the `RegisterTypeInIl2Cpp` attribute. This is necessary for Il2Cpp to recognize your class and allow it to be used in the game.

```csharp
using Il2CppInterop.Runtime;
using Il2CppScheduleOne;

[RegisterTypeInIl2Cpp]
public class MyCommand : ConsoleCommand
{
    public MyCommand(IntPtr ptr) : base(ptr)
    {
    }

    // This constructor is required if we're instatiating from Mono side like
    // new MyCommand();
    // Not needed if not instantiating - don't use this constructor for MonoBehaviours
    public MyCommand() : base(ClassInjector.DerivedConstructorPointer<MyCommand>())
    {
        ClassInjector.DerivedConstructorBody(this);
    }

// Other members required by ConsoleCommand, omitting for brevity
}
```

{{< alert context="primary" >}}
Alternatively, you can manually register the type using <code>ClassInjector.RegisterTypeInIl2Cpp&lt;T&gt;()</code> method.
{{< /alert >}}

### Coroutines
Use `MelonCoroutines`. 

{{< alert context="danger" >}}
Don't put <b>IEnumerator</b>s in types registered with <code>RegisterTypeInIl2Cpp</code>, as they will not work properly.
{{< /alert >}}

```csharp
using UnityEngine;
using MelonLoader;
public IEnumerator MyCoroutine()
{
    yield return new WaitForSeconds(1f);
    // Do something
}
MelonCoroutines.Start(MyCoroutine());
```

## Supporting both branches
Some modders want to support both branches of Schedule I, Mono and Il2Cpp. This is possible, but requires some extra work.

### Git Branches
You can create two branches in your repository, one for Mono and one for Il2Cpp.

{{< alert context="warning" >}}
This might result in some duplicated code, as only some of the implementation will be exclusive to one branch or the other.
{{< /alert >}}

### Conditional Compilation
You can use conditional compilation to include or exclude code based on the target platform. For example, you can use `#if IL2CPP` to include code only for Il2Cpp builds, or `#if MONO` for Mono builds.
```csharp
#if IL2CPP
using Il2CppScheduleOne;
#else
using ScheduleOne;
#endif
public class MyMod : MelonMod
{
    public override void OnInitializeMelon()
    {
#if IL2CPP
        // Il2Cpp specific code
        MelonLogger.Msg("Running on Il2Cpp");
#else
        // Mono specific code
        MelonLogger.Msg("Running on Mono");
#endif
    }
}
```
When compiling your mod, you can define the `IL2CPP` or `MONO` symbols in the build settings. This will allow you to include or exclude code based on the target platform. Some of the templates shown in [Getting Started](/docs/moddevs/environment_setup/) already have these symbols defined, so you can use them directly.

{{< alert context="info" >}}
This is a more convenient way to support both branches, as you only have to maintain one codebase and use conditional compilation to include or exclude code based on the target platform.
{{< /alert >}}
